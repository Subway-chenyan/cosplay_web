# Django 后端开发规范

## 项目技术栈

### 核心框架
- Django 4.2.7
- Django REST Framework 3.14.0
- PostgreSQL 数据库
- Redis 缓存和会话存储（可选）

### 主要依赖
- psycopg2-binary: PostgreSQL 适配器
- django-cors-headers: 跨域请求处理
- django-filter: API 过滤功能
- drf-spectacular: OpenAPI 文档生成
- djangorestframework-simplejwt: JWT 令牌认证

## 项目结构规范

### 应用模块组织
```
backend/
├── cosplay_api/           # 主项目配置
│   ├── settings.py        # 项目设置
│   ├── urls.py            # 主路由配置
│   ├── wsgi.py            # WSGI 配置
│   └── asgi.py            # ASGI 配置
├── apps/                  # 业务应用模块
│   ├── videos/            # 视频管理模块
│   ├── groups/            # 社团管理模块
│   ├── competitions/      # 比赛管理模块
│   ├── tags/              # 标签管理模块
│   ├── awards/            # 奖项管理模块
│   └── users/             # 用户管理模块
├── requirements.txt       # 依赖列表
└── manage.py              # Django 管理脚本
```

### 每个应用模块结构
```
app_name/
├── __init__.py
├── admin.py           # Django 管理后台配置
├── apps.py            # 应用配置
├── models.py          # 数据模型
├── serializers.py     # DRF 序列化器
├── views.py           # API 视图
├── urls.py            # 路由配置
├── filters.py         # 过滤器（如需要）
├── permissions.py     # 权限类（如需要）
├── validators.py      # 校验器（如需要）
└── migrations/        # 数据库迁移文件
```

## 代码规范

### 命名约定
- **模型类**: 使用 PascalCase，如 `Video`、`Group`
- **变量和函数**: 使用 snake_case，如 `video_title`, `get_video_list`
- **常量**: 使用 UPPER_SNAKE_CASE，如 `MAX_UPLOAD_SIZE`
- **URL 命名**: 使用 kebab-case，如 `video-list`, `group-detail`

### 模型设计规范
- 只保留核心模型：User（仅管理员/编辑）、Video、Group、Tag、Competition、Award、AwardRecord
- 不包含剧目、收藏、评分、评论、观看记录等模型
- 字段命名统一、主键为 `id`，外键为 `{model_name}_id`
- 时间戳字段：`created_at`, `updated_at`

### 序列化器规范
- 只为核心模型编写序列化器
- 字段只读属性合理设置

### 视图类规范
- 只为核心模型编写ViewSet
- 遵循RESTful API设计

## API 设计规范

### RESTful URL 设计
```
# urls.py
urlpatterns = [
    path('videos/', VideoListCreateView.as_view(), name='video-list'),
    path('videos/<int:pk>/', VideoRetrieveUpdateDestroyView.as_view(), name='video-detail'),
    path('groups/', GroupListCreateView.as_view(), name='group-list'),
    path('groups/<int:pk>/', GroupRetrieveUpdateDestroyView.as_view(), name='group-detail'),
    path('competitions/', CompetitionListCreateView.as_view(), name='competition-list'),
    path('competitions/<int:pk>/', CompetitionRetrieveUpdateDestroyView.as_view(), name='competition-detail'),
    path('awards/', AwardListCreateView.as_view(), name='award-list'),
    path('awards/<int:pk>/', AwardRetrieveUpdateDestroyView.as_view(), name='award-detail'),
    path('tags/', TagListCreateView.as_view(), name='tag-list'),
    path('tags/<int:pk>/', TagRetrieveUpdateDestroyView.as_view(), name='tag-detail'),
]
```

### HTTP 状态码使用
- `200 OK`: 成功获取资源
- `201 Created`: 成功创建资源
- `204 No Content`: 成功删除资源
- `400 Bad Request`: 请求参数错误
- `401 Unauthorized`: 未认证
- `403 Forbidden`: 无权限
- `404 Not Found`: 资源不存在
- `500 Internal Server Error`: 服务器错误

### 响应格式规范
```json
{
  "code": 200,
  "message": "success",
  "data": { ... }
}
```

## 数据库设计规范
- 只保留核心表结构
- 表命名使用复数形式：`videos`, `groups`, `competitions`, `awards`, `tags`, `users`, `award_records`
- 关联表使用下划线连接：`video_tags`, `video_groups`
- 字段命名、索引、外键等遵循一致性

## 其它
- 代码需有适当注释
- 重要业务逻辑需有单元测试
- 遵循本规范进行开发，确保代码质量和项目可维护性
